<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: extendWorldCollision.js</title>
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Libre+Franklin:400,700" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/main.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"applicationName":"phina-extensions","default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">phina-extensions</a></h3>
    <button id="menuToggle" class="btn btn-link btn-lg menu-toggle">
        <span class="glyphicon glyphicon-menu-hamburger"></span>
    </button>
    <div class="search">
        <input id="search" type="text" class="form-control input-md" placeholder="Search...">
    </div>
    <ul class="list">
    
        <li class="item" data-name="phina">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.html">phina</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.accessory.html">phina.accessory</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.display.html">phina.display</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.game">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.game.html">phina.game</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-folder-open"></span>
                </span>
                
                <a href="phina.ui.html">phina.ui</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="global">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-globe"></span>
                </span>
                
                <a href="global.html">Global</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li class="parent" data-name="SceneItem"><a href="global.html#SceneItem">SceneItem</a></li>
            
                <li class="parent" data-name="Vector2"><a href="global.html#Vector2">Vector2</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.AfterImage">
            <span class="title  ">
                
                <a href="phina.accessory.AfterImage.html">phina.accessory.AfterImage</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#_toTexture"><a href="phina.accessory.AfterImage.html#_toTexture">_toTexture</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#poolImage"><a href="phina.accessory.AfterImage.html#poolImage">poolImage</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#remove"><a href="phina.accessory.AfterImage.html#remove">remove</a></li>
            
                <li class="parent  " data-name="phina.accessory.AfterImage#setVisible"><a href="phina.accessory.AfterImage.html#setVisible">setVisible</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.Drawer">
            <span class="title  ">
                
                <a href="phina.accessory.Drawer.html">phina.accessory.Drawer</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.Drawer#hide"><a href="phina.accessory.Drawer.html#hide">hide</a></li>
            
                <li class="parent  " data-name="phina.accessory.Drawer#show"><a href="phina.accessory.Drawer.html#show">show</a></li>
            
                <li class="parent  " data-name="phina.accessory.Drawer#toggle"><a href="phina.accessory.Drawer.html#toggle">toggle</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.accessory.Fader">
            <span class="title  ">
                
                <a href="phina.accessory.Fader.html">phina.accessory.Fader</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.accessory.Fader#hide"><a href="phina.accessory.Fader.html#hide">hide</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#pulse"><a href="phina.accessory.Fader.html#pulse">pulse</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#show"><a href="phina.accessory.Fader.html#show">show</a></li>
            
                <li class="parent  " data-name="phina.accessory.Fader#toggle"><a href="phina.accessory.Fader.html#toggle">toggle</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.AnimationSprite">
            <span class="title  ">
                
                <a href="phina.display.AnimationSprite.html">phina.display.AnimationSprite</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.display.AnimationSprite#setAnimation"><a href="phina.display.AnimationSprite.html#setAnimation">setAnimation</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.DashedLineShape">
            <span class="title  ">
                
                <a href="phina.display.DashedLineShape.html">phina.display.DashedLineShape</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.PetalShape">
            <span class="title  ">
                
                <a href="phina.display.PetalShape.html">phina.display.PetalShape</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.display.ScrollLayer">
            <span class="title  ">
                
                <a href="phina.display.ScrollLayer.html">phina.display.ScrollLayer</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setCoordinate"><a href="phina.display.ScrollLayer.html#setCoordinate">setCoordinate</a></li>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setLock"><a href="phina.display.ScrollLayer.html#setLock">setLock</a></li>
            
                <li class="parent  " data-name="phina.display.ScrollLayer#setTarget"><a href="phina.display.ScrollLayer.html#setTarget">setTarget</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.game.Sequence">
            <span class="title  ">
                
                <a href="phina.game.Sequence.html">phina.game.Sequence</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui.DebugLabel">
            <span class="title  ">
                
                <a href="phina.ui.DebugLabel.html">phina.ui.DebugLabel</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#clear"><a href="phina.ui.DebugLabel.html#clear">clear</a></li>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#subscribe"><a href="phina.ui.DebugLabel.html#subscribe">subscribe</a></li>
            
                <li class="parent  " data-name="phina.ui.DebugLabel#updateLabel"><a href="phina.ui.DebugLabel.html#updateLabel">updateLabel</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="phina.ui.ScrollableLabelArea">
            <span class="title  ">
                
                <a href="phina.ui.ScrollableLabelArea.html">phina.ui.ScrollableLabelArea</a>
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li class="parent " data-name="phina.ui.ScrollableLabelArea#canvasHeight"><a href="phina.ui.ScrollableLabelArea.html#canvasHeight">canvasHeight</a></li>
            
                <li class="parent " data-name="phina.ui.ScrollableLabelArea#textAreaHeight"><a href="phina.ui.ScrollableLabelArea.html#textAreaHeight">textAreaHeight</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="phina.ui.ScrollableLabelArea#addLine"><a href="phina.ui.ScrollableLabelArea.html#addLine">addLine</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="extendWorldCollision.js.html">Source: extendWorldCollision.js</h1>
        


    
    <section>
        <header>
            <div class="header content-size">
                <h2>extendWorldCollision.js</h2>
            </div>
        </header>
        <article>
            <pre id="source-code" class="prettyprint source "><code>////////
// Enables phina.app.Object2D inherited Class the methods related to world-coordinate postion and collision.
// TODO: test methods
////////

export var EXTENDED_METHODS = [
  // /**
  //  * template
  //  */
  // {
  //   name: "",
  //   func: function() {
  //   }
  // },

  /**
   * phina.app.Object2D.prototype.getWorldPosition
   * @param {boolean} useCache - ワールド座標の再計算をせず、計算済みの値を使うかどうか
   * @return {phina.geom.Vector2} 自身のワールド座標を返す
   */
  {
    name: "getWorldPosition",
    func: function(useCache=false) {
      var wm = (useCache === true) ? this._worldMatrix : this._calcWorldMatrix()._worldMatrix;
      return phina.geom.Vector2(wm.m02, wm.m12);
    }
  },

  /**
   * phina.app.Object2D.prototype.getWorldCircle
   * @param {boolean} useCache - ワールド座標の再計算をせず、計算済みの値を使うかどうか
   * @return {phina.geom.Circle} 自身のワールド座標上の円形判定を返す
   */
  {
    name: "getWorldCircle",
    func: function(useCache=false) {
      var wm = (useCache === true) ? this._worldMatrix : this._calcWorldMatrix()._worldMatrix;
      return phina.geom.Circle(wm.m02, wm.m12, this.radius);
    }
  },

  /**
   * phina.app.Object2D.prototype.getWorldRect
   * @param {boolean} useCache - ワールド座標の再計算をせず、計算済みの値を使うかどうか
   * @return {phina.geom.Rect} 自身のワールド座標上の矩形判定を返す
   */
  {
    name: "getWorldRect",
    func: function(useCache=false) {
      var wm = (useCache === true) ? this._worldMatrix : this._calcWorldMatrix()._worldMatrix;
      const left = wm.m02 - this.origin.x * this.width;
      const top = wm.m12 - this.origin.y * this.height;
      return phina.geom.Rect(left, top, this.width, this.height);
    }
  },

  /**
   * phina.app.Object2D.prototype.hitTestWorldPoint
   * @return {boolean} hittest result
   */
  {
    name: "hitTestWorldPoint",
    func: function(target) {
      let hitArea;
      if (this.boundingType === 'rect') {
        hitArea = this.getWorldRect();
      } else {
        hitArea = this.getWorldCircle();
      }
      return hitArea.contains(target.wx, target.wy);
    }
  },

  /**
   * phina.app.Object2D.prototype.hitTestWorldTarget
   * returns hittest using phina.geom.Collision
   * depends on boundingType
   * @return {boolean} hittest result
   */
  {
    name: "hitTestWorldTarget",
    func: function(target, useCache=true) {
      if (this.boundingType === 'rect') {
        // rect vs ...
        const thisHitRect = this.getWorldRect(useCache);
        switch (target.boundingType) {
          case 'rect':
            return phina.geom.Collision.testRectRect(thisHitRect, target.getWorldRect(useCache))
            break;
          case 'circle':
            return phina.geom.Collision.testCircleRect(target.getWorldCircle(useCache), thisHitRect);
            break;
        }
      } else if (this.boundingType === 'circle') {
        // circle vs ...
        const thisHitCircle = this.getWorldCircle(useCache);
        switch (target.boundingType) {
          case 'rect':
            return phina.geom.Collision.testCircleRect(thisHitCircle, target.getWorldRect(useCache));
            break;
          case 'circle':
            return phina.geom.Collision.testCircleCircle(thisHitCircle, target.getWorldCircle(useCache))
            break;
        }
      }
    }
  },

  /**
   * phina.app.Object2D.prototype.hitTestRecursive
   * targetのchildrenまで下ってそれぞれコールバック処理を行う
   * 深さ優先探索
   * @params {function} success
   * @params {function} failure
   * @return {void}
   */
  {
    name: "hitTestRecursive",
    func: function(target, success, failure) {
      if (this.hitTestWorldTarget(target)) {
        success(target);
      } else {
        if (failure &amp;&amp; typeof failure === 'function') failure(target);
      }
      if (target.children &amp;&amp; target.children.length) {
        target.children.forEach((child)=> {
          this.hitTestRecursive(child, success, failure);
        });
      }
    }
  },

];

// phina.app.Object2D.prototype.getWorldPosition = function() {
//   var wm = this._calcWorldMatrix()._worldMatrix;
//   return phina.geom.Vector2(wm.m02, wm.m12);
// };

// phina.app.Object2D.prototype.getWorldCircle = function() {
//   // var wm = this._calcWorldMatrix()._worldMatrix; //thisがreturnされない時がある
//   // this._calcWorldMatrix();
//   var wm = this._worldMatrix;
//   return phina.geom.Circle(wm.m02, wm.m12, this.radius);
// };

// phina.app.Object2D.prototype.getWorldRect = function() {
//   var wm = this._calcWorldMatrix()._worldMatrix;
//   return phina.geom.Rect(wm.m02, wm.m12, this.width, this.height);
// };

// phina.app.Object2D.prototype.hitTestWorldCircle = function(target) {
//   var thisWorldCirc = this.getWorldCircle();
//   var targetWorldCirc = target.getWorldCircle();
//   return phina.geom.Collision.testCircleCircle(thisWorldCirc, targetWorldCirc)
// };

// phina.app.Object2D.prototype.hitTestCircleRecursive = function(target, func) {
//   if (this.hitTestWorldCircle(target)) {
//     func();
//   };
//   if (target.children) {
//     target.children.forEach(function(child){
//       this.hitTestCircleRecursive(child, func);
//     }.bind(this));
//   }
// };

/**
 * phina.extendWorldCollision
 *
 * @return {void}
 */
export default function() {
  EXTENDED_METHODS.forEach(function(data) {
    phina.app.Object2D.prototype[data.name] = data.func;
  });

  // add accessor
  // @caveats World position is updated during the draw method, so it does'nt always return the exact position
  phina.app.Object2D.prototype.getter("wx", function() {
    return this._worldMatrix.m02;
  });
  phina.app.Object2D.prototype.getter("wy", function() {
    return this._worldMatrix.m12;
  });
}</code></pre>
        </article>
    </section>






        

        <footer class="content-size">
            <div class="footer">
                Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Sep 12 2019 03:29:47 GMT+0900 (GMT+09:00)
            </div>
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/main.js"></script>
</body>
</html>
